---
  name: Validate Delta Changes with Base Branch
  on:
    pull_request:
      branches:
        - QA
  jobs:
    validate-delta-changes:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v2
          with:
            fetch-depth: 0
        - name: Set up Python
          uses: actions/setup-python@v2
          with:
            python-version: 3.x
        - name: Install dependencies
          run: |
            npm install -g @salesforce/cli
            python -m pip install --upgrade pip
            pip install -r requirements.txt
        - name: Authenticate to Salesforce
          run: |
            echo ${{ secrets.SF_AUTH_URL }} > sfdx-auth-url.txt
            cat sfdx-auth-url.txt # Print file content for debugging
            sfdx auth:sfdxurl:store --sfdx-url-file sfdx-auth-url.txt
        - name: Compare changes with base branch
          run: >
            git fetch origin ${{ github.base_ref }}  # Fetch the base branch
  
            git diff --name-only origin/${{ github.base_ref }} ${{ github.head_ref }} | grep '\.py$' | xargs pylint
        - name: Run tests on changed files
          run: >
            git fetch origin ${{ github.base_ref }}  # Fetch the base branch
  
            git diff --name-only origin/${{ github.base_ref }} ${{ github.head_ref }} | grep '\.py$' | xargs pytest  